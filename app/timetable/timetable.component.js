"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var router_1 = require("@angular/router");
var timetable_model_1 = require("../model/timetable.model");
var timetable_model_2 = require("~/model/timetable.model");
var appvalues_service_1 = require("~/service/appvalues.service");
var homework_service_1 = require("~/service/homework.service");
var timetable_service_1 = require("../service/timetable.service");
var homework_model_1 = require("~/model/homework.model");
var TimetableComponent = /** @class */ (function () {
    function TimetableComponent(appValuesService, homeworkService, router, timetableService) {
        this.appValuesService = appValuesService;
        this.homeworkService = homeworkService;
        this.router = router;
        this.timetableService = timetableService;
        this.subscriptions = [];
        this.homeworkIcon = "";
        this.lessonDate = new Date();
        this.startDate = new Date();
        this.endDate = new Date();
        this.allHomeworks = [];
        this.allDueHomeworks = [];
        this.allLessons = [];
        this.lessonsForDate = [];
        this.allPeriods = [];
        this.periodsForDate = [];
        this.tabDates = [];
        this.current = false;
        this.hasLesson = true;
        this.isDueLesson = false;
        this.isLoading = true;
        this.lastLesson = false;
        this.showDetails = false;
        this.dateRange = [];
        this.selectedStudent = this.appValuesService.getSelectedStudent();
        this.startDate.setDate(this.startDate.getDate() - (this.startDate.getDay() + 7));
        this.endDate.setDate(this.endDate.getDate() - (this.endDate.getDay() - 14));
        this.getAllHomework();
        this.getLessonsDateRange();
        this.getLessons();
        this.getPeriods();
    }
    TimetableComponent.prototype.ngOnInit = function () { };
    TimetableComponent.prototype.ngOnDestroy = function () {
        if (this.subscriptions) {
            for (var _i = 0, _a = this.subscriptions; _i < _a.length; _i++) {
                var subscription = _a[_i];
                subscription.unsubscribe();
            }
        }
    };
    TimetableComponent.prototype.getAllHomework = function () {
        var _this = this;
        this.subscriptions.push(this.homeworkService.getStudentHomework(this.selectedStudent.id)
            .subscribe(function (homework) {
            _this.allHomeworks = homework;
        }));
    };
    TimetableComponent.prototype.getCurrentLesson = function (lesson) {
        var today = new Date();
        if ((today >= new Date(lesson.startDate)) && (today <= new Date(lesson.endDate))) {
            this.current = true;
            return true;
        }
        else {
            this.current = false;
            return false;
        }
    };
    TimetableComponent.prototype.getHomeworkDueDate = function (lesson) {
        var dueHomework = this.allHomeworks.find(function (h) {
            return h.subject == lesson.subject;
        });
        if (dueHomework != undefined) {
            this.allDueHomeworks.push(dueHomework);
            var isOverdue = this.homeworkService.getHomeworkDeadlineStatus(dueHomework) === homework_model_1.HomeworkDeadlineStatus.overDue;
            if (isOverdue === true) {
                this.isDueLesson = true;
                this.homeworkIcon = String.fromCharCode(0xe91f);
                return true;
            }
        }
        return false;
    };
    TimetableComponent.prototype.getLessons = function () {
        var _this = this;
        this.subscriptions.push(this.timetableService.getLessons(this.dateRange)
            .subscribe(function (lessons) {
            lessons = lessons.sort(function (obj1, obj2) {
                return new Date(obj1.startDate).getHours() - new Date(obj2.startDate).getHours();
            });
            _this.allLessons = lessons;
            _this.getTabDateLesson();
        }));
    };
    TimetableComponent.prototype.getLessonsDateRange = function () {
        // one week previous date
        var minDate = new Date();
        minDate.setDate(minDate.getDate() - (minDate.getDay() + 7));
        // one week future date
        var maxDate = new Date();
        maxDate.setDate(maxDate.getDate() - (maxDate.getDay() - 13));
        var tabItemDate = new Date();
        while (tabItemDate < maxDate) {
            tabItemDate = new Date(minDate.setDate(minDate.getDate() + 1));
            this.dateRange.push(tabItemDate.toString());
        }
    };
    TimetableComponent.prototype.getLessonsForDate = function (date) {
        if (!this.allLessons) {
            this.lessonsForDate = [];
            return;
        }
        this.lessonsForDate = this.allLessons.filter(function (l) { return new Date(l.startDate).toDateString() === date.toDateString(); });
    };
    TimetableComponent.prototype.getPeriods = function () {
        var _this = this;
        this.subscriptions.push(this.timetableService.getPeriods(this.dateRange)
            .subscribe(function (p) {
            _this.allPeriods = p;
        }));
    };
    TimetableComponent.prototype.getPeriodNameForLesson = function (lesson) {
        var name = "";
        var startLessonDay = new Date(lesson.startDate).getDay();
        var startLessonHour = new Date(lesson.startDate).getHours();
        var startLessonMinute = new Date(lesson.startDate).getMinutes();
        var endLessonDay = new Date(lesson.endDate).getDay();
        var endLessonHour = new Date(lesson.endDate).getHours();
        var endLessonMinute = new Date(lesson.endDate).getMinutes();
        var period = this.allPeriods.find(function (p) {
            return new Date(p.startDate).getDay() == startLessonDay &&
                new Date(p.startDate).getHours() == startLessonHour &&
                new Date(p.startDate).getMinutes() == startLessonMinute &&
                new Date(p.endDate).getDay() == endLessonDay &&
                new Date(p.endDate).getHours() == endLessonHour &&
                new Date(p.endDate).getMinutes() == endLessonMinute;
        });
        if (period) {
            name = period.name;
        }
        return name;
    };
    TimetableComponent.prototype.getSubjectColour = function (lesson) {
        var subject = timetable_model_2.Subject;
        var color = "";
        switch (lesson.subject) {
            case subject.art: {
                color = "#8B0000";
                break;
            }
            case subject.computing: {
                color = "#8B4513";
                break;
            }
            case subject.design: {
                color = "#808000";
                break;
            }
            case subject.english: {
                color = "#2ECCFA";
                break;
            }
            case subject.geography: {
                color = "#FA58F4";
                break;
            }
            case subject.history: {
                color = "#04B404";
                break;
            }
            case subject.languages: {
                color = "#BF00FF";
                break;
            }
            case subject.math: {
                color = "#FF8000";
                break;
            }
            case subject.music: {
                color = "#642EFE";
                break;
            }
            case subject.pe: {
                color = "#FFFF00";
                break;
            }
            case subject.reg: {
                color = "#086A87";
                break;
            }
            case subject.science: {
                color = "#FF0000";
                break;
            }
        }
        return color;
    };
    TimetableComponent.prototype.getTabDateLesson = function () {
        for (var _i = 0, _a = this.dateRange; _i < _a.length; _i++) {
            var tabDate = _a[_i];
            this.getLessonsForDate(new Date(tabDate));
            var timetableTab = new timetable_model_1.TimetableTab;
            timetableTab.date = tabDate;
            timetableTab.lessons = this.lessonsForDate;
            this.tabDates.push(timetableTab);
        }
        this.isLoading = false;
    };
    TimetableComponent.prototype.onTabSwipe = function (args) {
        var _this = this;
        if (args.oldIndex !== -1) {
            return;
        }
        var _loop_1 = function (tabDate) {
            if (new Date(tabDate.date).getDate() === this_1.lessonDate.getDate()) {
                setTimeout(function () { _this.tabSelectedIndex = _this.dateRange.findIndex(function (x) { return x == tabDate.date; }); }, 200);
                return { value: void 0 };
            }
        };
        var this_1 = this;
        for (var _i = 0, _a = this.tabDates; _i < _a.length; _i++) {
            var tabDate = _a[_i];
            var state_1 = _loop_1(tabDate);
            if (typeof state_1 === "object")
                return state_1.value;
        }
    };
    TimetableComponent.prototype.onTapHomework = function (lesson) {
        var homework = this.allDueHomeworks.find(function (h) {
            return h.subject == lesson.subject;
        });
        this.router.navigate(["/homeworkdetails/" + homework.id]);
    };
    TimetableComponent = __decorate([
        core_1.Component({
            moduleId: module.id,
            selector: 'ns-timetable',
            templateUrl: './timetable.component.html',
            styleUrls: ['./timetable.component.less']
        }),
        __metadata("design:paramtypes", [appvalues_service_1.AppValuesService,
            homework_service_1.HomeworkService,
            router_1.Router,
            timetable_service_1.TimetableService])
    ], TimetableComponent);
    return TimetableComponent;
}());
exports.TimetableComponent = TimetableComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGltZXRhYmxlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInRpbWV0YWJsZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxzQ0FBMkU7QUFDM0UsMENBQXlDO0FBSXpDLDREQUF3RTtBQUN4RSwyREFBa0Q7QUFHbEQsaUVBQStEO0FBQy9ELCtEQUE2RDtBQUM3RCxrRUFBZ0U7QUFDaEUseURBQTBFO0FBUTFFO0lBZ0NJLDRCQUNZLGdCQUFrQyxFQUNsQyxlQUFnQyxFQUNoQyxNQUFjLEVBQ2QsZ0JBQWtDO1FBSGxDLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUFDbEMsb0JBQWUsR0FBZixlQUFlLENBQWlCO1FBQ2hDLFdBQU0sR0FBTixNQUFNLENBQVE7UUFDZCxxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO1FBbkN0QyxrQkFBYSxHQUFvQixFQUFFLENBQUM7UUFFNUMsaUJBQVksR0FBRyxFQUFFLENBQUM7UUFJbEIsZUFBVSxHQUFTLElBQUksSUFBSSxFQUFFLENBQUM7UUFDOUIsY0FBUyxHQUFTLElBQUksSUFBSSxFQUFFLENBQUM7UUFDN0IsWUFBTyxHQUFTLElBQUksSUFBSSxFQUFFLENBQUM7UUFFM0IsaUJBQVksR0FBZSxFQUFFLENBQUM7UUFDOUIsb0JBQWUsR0FBZSxFQUFFLENBQUM7UUFFakMsZUFBVSxHQUFhLEVBQUUsQ0FBQztRQUMxQixtQkFBYyxHQUFhLEVBQUUsQ0FBQztRQUU5QixlQUFVLEdBQWEsRUFBRSxDQUFDO1FBQzFCLG1CQUFjLEdBQWEsRUFBRSxDQUFDO1FBRTlCLGFBQVEsR0FBbUIsRUFBRSxDQUFDO1FBRTlCLFlBQU8sR0FBRyxLQUFLLENBQUM7UUFDaEIsY0FBUyxHQUFHLElBQUksQ0FBQztRQUNqQixnQkFBVyxHQUFHLEtBQUssQ0FBQztRQUNwQixjQUFTLEdBQUcsSUFBSSxDQUFDO1FBQ2pCLGVBQVUsR0FBRyxLQUFLLENBQUM7UUFDbkIsZ0JBQVcsR0FB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YztZQUN4QixXQUFXLEVBQUUsNEJBQTRCO1lBQ3pDLFNBQVMsRUFBRSxDQUFDLDRCQUE0QixDQUFDO1NBQzVDLENBQUM7eUNBa0NnQyxvQ0FBZ0I7WUFDakIsa0NBQWU7WUFDeEIsZUFBTTtZQUNJLG9DQUFnQjtPQXBDckMsa0JBQWtCLENBNFE5QjtJQUFELHlCQUFDO0NBQUEsQUE1UUQsSUE0UUM7QUE1UVksZ0RBQWtCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQsIE9uRGVzdHJveSwgQWZ0ZXJWaWV3SW5pdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnXHJcbmltcG9ydCB7IFJvdXRlciB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XHJcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBTZWxlY3RlZEluZGV4Q2hhbmdlZEV2ZW50RGF0YSB9IGZyb20gXCJ0bnMtY29yZS1tb2R1bGVzL3VpL3RhYi12aWV3XCI7XHJcblxyXG5pbXBvcnQgeyBMZXNzb24sIFBlcmlvZCwgVGltZXRhYmxlVGFiIH0gZnJvbSBcIi4uL21vZGVsL3RpbWV0YWJsZS5tb2RlbFwiO1xyXG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAnfi9tb2RlbC90aW1ldGFibGUubW9kZWwnO1xyXG5pbXBvcnQgeyBVc2VyIH0gZnJvbSAnfi9tb2RlbC91c2VyLm1vZGVsJztcclxuXHJcbmltcG9ydCB7IEFwcFZhbHVlc1NlcnZpY2UgfSBmcm9tICd+L3NlcnZpY2UvYXBwdmFsdWVzLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBIb21ld29ya1NlcnZpY2UgfSBmcm9tICd+L3NlcnZpY2UvaG9tZXdvcmsuc2VydmljZSc7XHJcbmltcG9ydCB7IFRpbWV0YWJsZVNlcnZpY2UgfSBmcm9tIFwiLi4vc2VydmljZS90aW1ldGFibGUuc2VydmljZVwiO1xyXG5pbXBvcnQgeyBIb21ld29yaywgSG9tZXdvcmtEZWFkbGluZVN0YXR1cyB9IGZyb20gJ34vbW9kZWwvaG9tZXdvcmsubW9kZWwnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBtb2R1bGVJZDogbW9kdWxlLmlkLFxyXG4gICAgc2VsZWN0b3I6ICducy10aW1ldGFibGUnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcuL3RpbWV0YWJsZS5jb21wb25lbnQuaHRtbCcsXHJcbiAgICBzdHlsZVVybHM6IFsnLi90aW1ldGFibGUuY29tcG9uZW50Lmxlc3MnXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgVGltZXRhYmxlQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3kge1xyXG4gICAgcHJpdmF0ZSBzdWJzY3JpcHRpb25zIDogU3Vic2NyaXB0aW9uW10gPSBbXTtcclxuICAgIFxyXG4gICAgaG9tZXdvcmtJY29uID0gXCJcIjtcclxuXHJcbiAgICBzZWxlY3RlZFN0dWRlbnQ6IFVzZXI7XHJcbiAgICBcclxuICAgIGxlc3NvbkRhdGU6IERhdGUgPSBuZXcgRGF0ZSgpO1xyXG4gICAgc3RhcnREYXRlOiBEYXRlID0gbmV3IERhdGUoKTtcclxuICAgIGVuZERhdGU6IERhdGUgPSBuZXcgRGF0ZSgpO1xyXG5cclxuICAgIGFsbEhvbWV3b3JrczogSG9tZXdvcmtbXSA9IFtdO1xyXG4gICAgYWxsRHVlSG9tZXdvcmtzOiBIb21ld29ya1tdID0gW107XHJcblxyXG4gICAgYWxsTGVzc29uczogTGVzc29uW10gPSBbXTtcclxuICAgIGxlc3NvbnNGb3JEYXRlOiBMZXNzb25bXSA9IFtdO1xyXG5cclxuICAgIGFsbFBlcmlvZHM6IFBlcmlvZFtdID0gW107XHJcbiAgICBwZXJpb2RzRm9yRGF0ZTogUGVyaW9kW10gPSBbXTsgICAgXHJcblxyXG4gICAgdGFiRGF0ZXM6IFRpbWV0YWJsZVRhYltdID0gW107XHJcbiAgICBcclxuICAgIGN1cnJlbnQgPSBmYWxzZTtcclxuICAgIGhhc0xlc3NvbiA9IHRydWU7XHJcbiAgICBpc0R1ZUxlc3NvbiA9IGZhbHNlO1xyXG4gICAgaXNMb2FkaW5nID0gdHJ1ZTtcclxuICAgIGxhc3RMZXNzb24gPSBmYWxzZTtcclxuICAgIHNob3dEZXRhaWxzID0gZmFsc2U7XHJcbiAgICBcclxuICAgIGRhdGVSYW5nZSA9IFtdO1xyXG4gICAgdGFiU2VsZWN0ZWRJbmRleDogbnVtYmVyO1xyXG4gICAgICAgICAgIFxyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgcHJpdmF0ZSBhcHBWYWx1ZXNTZXJ2aWNlOiBBcHBWYWx1ZXNTZXJ2aWNlLFxyXG4gICAgICAgIHByaXZhdGUgaG9tZXdvcmtTZXJ2aWNlOiBIb21ld29ya1NlcnZpY2UsXHJcbiAgICAgICAgcHJpdmF0ZSByb3V0ZXI6IFJvdXRlcixcclxuICAgICAgICBwcml2YXRlIHRpbWV0YWJsZVNlcnZpY2U6IFRpbWV0YWJsZVNlcnZpY2UsXHJcbiAgICApIHtcclxuICAgICAgICB0aGlzLnNlbGVjdGVkU3R1ZGVudCA9IHRoaXMuYXBwVmFsdWVzU2VydmljZS5nZXRTZWxlY3RlZFN0dWRlbnQoKTtcclxuXHJcbiAgICAgICAgdGhpcy5zdGFydERhdGUuc2V0RGF0ZSh0aGlzLnN0YXJ0RGF0ZS5nZXREYXRlKCkgLSAodGhpcy5zdGFydERhdGUuZ2V0RGF5KCkgKyA3KSk7XHJcbiAgICAgICAgdGhpcy5lbmREYXRlLnNldERhdGUodGhpcy5lbmREYXRlLmdldERhdGUoKSAtICh0aGlzLmVuZERhdGUuZ2V0RGF5KCkgLSAxNCkpO1xyXG5cclxuICAgICAgICB0aGlzLmdldEFsbEhvbWV3b3JrKCk7XHJcbiAgICAgICAgdGhpcy5nZXRMZXNzb25zRGF0ZVJhbmdlKCk7XHJcbiAgICAgICAgdGhpcy5nZXRMZXNzb25zKCk7XHJcbiAgICAgICAgdGhpcy5nZXRQZXJpb2RzKCk7XHJcbiAgICAgfVxyXG5cclxuICAgIG5nT25Jbml0KCkgeyB9XHJcblxyXG4gICAgbmdPbkRlc3Ryb3koKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuc3Vic2NyaXB0aW9ucykge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBzdWJzY3JpcHRpb24gb2YgdGhpcy5zdWJzY3JpcHRpb25zKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBnZXRBbGxIb21ld29yaygpIHtcclxuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMucHVzaCh0aGlzLmhvbWV3b3JrU2VydmljZS5nZXRTdHVkZW50SG9tZXdvcmsodGhpcy5zZWxlY3RlZFN0dWRlbnQuaWQpXHJcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoXHJcbiAgICAgICAgICAgICAgICBob21ld29yayA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hbGxIb21ld29ya3MgPSBob21ld29yaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgKVxyXG4gICAgICAgIClcclxuICAgIH1cclxuXHJcbiAgICBnZXRDdXJyZW50TGVzc29uKGxlc3NvbjogTGVzc29uKTogYm9vbGVhbiB7XHJcbiAgICAgICAgbGV0IHRvZGF5ID0gbmV3IERhdGUoKTtcclxuXHJcbiAgICAgICAgaWYgKCh0b2RheSA+PSBuZXcgRGF0ZShsZXNzb24uc3RhcnREYXRlKSkgJiYgKHRvZGF5IDw9IG5ldyBEYXRlKGxlc3Nvbi5lbmREYXRlKSkpIHtcclxuICAgICAgICAgICAgdGhpcy5jdXJyZW50ID0gdHJ1ZTtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5jdXJyZW50ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0SG9tZXdvcmtEdWVEYXRlKGxlc3NvbjogTGVzc29uKTogYm9vbGVhbiB7XHJcbiAgICAgICAgY29uc3QgZHVlSG9tZXdvcmsgPSB0aGlzLmFsbEhvbWV3b3Jrcy5maW5kKGggPT5cclxuICAgICAgICAgICAgaC5zdWJqZWN0ID09IGxlc3Nvbi5zdWJqZWN0XHJcbiAgICAgICAgKTtcclxuXHJcbiAgICAgICAgaWYgKGR1ZUhvbWV3b3JrICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICB0aGlzLmFsbER1ZUhvbWV3b3Jrcy5wdXNoKGR1ZUhvbWV3b3JrKTtcclxuICAgICAgICAgICAgbGV0IGlzT3ZlcmR1ZSA9IHRoaXMuaG9tZXdvcmtTZXJ2aWNlLmdldEhvbWV3b3JrRGVhZGxpbmVTdGF0dXMoZHVlSG9tZXdvcmspID09PSBIb21ld29ya0RlYWRsaW5lU3RhdHVzLm92ZXJEdWU7XHJcblxyXG4gICAgICAgICAgICBpZiAoaXNPdmVyZHVlID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlzRHVlTGVzc29uID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHRoaXMuaG9tZXdvcmtJY29uID0gU3RyaW5nLmZyb21DaGFyQ29kZSgweGU5MWYpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRMZXNzb25zKCkge1xyXG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5wdXNoKHRoaXMudGltZXRhYmxlU2VydmljZS5nZXRMZXNzb25zKHRoaXMuZGF0ZVJhbmdlKVxyXG4gICAgICAgICAgICAuc3Vic2NyaWJlKFxyXG4gICAgICAgICAgICAgICAgbGVzc29ucyA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGVzc29ucyA9IGxlc3NvbnMuc29ydCAoKG9iajE6IExlc3Nvbiwgb2JqMjogTGVzc29uKSAgPT5cclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRGF0ZShvYmoxLnN0YXJ0RGF0ZSkuZ2V0SG91cnMoKSAtIG5ldyBEYXRlKG9iajIuc3RhcnREYXRlKS5nZXRIb3VycygpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWxsTGVzc29ucyA9IGxlc3NvbnM7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRUYWJEYXRlTGVzc29uKCk7XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICApXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRMZXNzb25zRGF0ZVJhbmdlKCkge1xyXG4gICAgICAgIC8vIG9uZSB3ZWVrIHByZXZpb3VzIGRhdGVcclxuICAgICAgICBsZXQgbWluRGF0ZSA9IG5ldyBEYXRlKCk7XHJcbiAgICAgICAgbWluRGF0ZS5zZXREYXRlKG1pbkRhdGUuZ2V0RGF0ZSgpIC0gKG1pbkRhdGUuZ2V0RGF5KCkgKyA3KSk7XHJcblxyXG4gICAgICAgIC8vIG9uZSB3ZWVrIGZ1dHVyZSBkYXRlXHJcbiAgICAgICAgbGV0IG1heERhdGUgPSBuZXcgRGF0ZSgpO1xyXG4gICAgICAgIG1heERhdGUuc2V0RGF0ZShtYXhEYXRlLmdldERhdGUoKSAtIChtYXhEYXRlLmdldERheSgpIC0gMTMpKTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgIGxldCB0YWJJdGVtRGF0ZSA9IG5ldyBEYXRlKCk7XHJcbiAgICAgICAgd2hpbGUgKHRhYkl0ZW1EYXRlIDwgbWF4RGF0ZSkge1xyXG4gICAgICAgICAgICB0YWJJdGVtRGF0ZSA9IG5ldyBEYXRlKG1pbkRhdGUuc2V0RGF0ZShtaW5EYXRlLmdldERhdGUoKSArIDEpKTtcclxuICAgICAgICAgICAgdGhpcy5kYXRlUmFuZ2UucHVzaCh0YWJJdGVtRGF0ZS50b1N0cmluZygpKTsgXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldExlc3NvbnNGb3JEYXRlKGRhdGU6IERhdGUpIHtcclxuICAgICAgICBpZiAoIXRoaXMuYWxsTGVzc29ucykge1xyXG4gICAgICAgICAgICB0aGlzLmxlc3NvbnNGb3JEYXRlID0gW107XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgdGhpcy5sZXNzb25zRm9yRGF0ZSA9IHRoaXMuYWxsTGVzc29ucy5maWx0ZXIobCA9PiBuZXcgRGF0ZShsLnN0YXJ0RGF0ZSkudG9EYXRlU3RyaW5nKCkgPT09IGRhdGUudG9EYXRlU3RyaW5nKCkpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFBlcmlvZHMoKSB7XHJcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zLnB1c2goXHJcbiAgICAgICAgICAgIHRoaXMudGltZXRhYmxlU2VydmljZS5nZXRQZXJpb2RzKHRoaXMuZGF0ZVJhbmdlKVxyXG4gICAgICAgICAgICAgICAgLnN1YnNjcmliZShwID0+IHsgXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hbGxQZXJpb2RzID0gcDtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRQZXJpb2ROYW1lRm9yTGVzc29uKGxlc3NvbjogTGVzc29uKTogc3RyaW5nIHtcclxuICAgICAgICBsZXQgbmFtZSA9IFwiXCI7XHJcblxyXG4gICAgICAgIGNvbnN0IHN0YXJ0TGVzc29uRGF5ID0gbmV3IERhdGUobGVzc29uLnN0YXJ0RGF0ZSkuZ2V0RGF5KCk7XHJcbiAgICAgICAgY29uc3Qgc3RhcnRMZXNzb25Ib3VyID0gbmV3IERhdGUobGVzc29uLnN0YXJ0RGF0ZSkuZ2V0SG91cnMoKTtcclxuICAgICAgICBjb25zdCBzdGFydExlc3Nvbk1pbnV0ZSA9IG5ldyBEYXRlKGxlc3Nvbi5zdGFydERhdGUpLmdldE1pbnV0ZXMoKTtcclxuICAgICAgICBjb25zdCBlbmRMZXNzb25EYXkgPSBuZXcgRGF0ZShsZXNzb24uZW5kRGF0ZSkuZ2V0RGF5KCk7XHJcbiAgICAgICAgY29uc3QgZW5kTGVzc29uSG91ciA9IG5ldyBEYXRlKGxlc3Nvbi5lbmREYXRlKS5nZXRIb3VycygpO1xyXG4gICAgICAgIGNvbnN0IGVuZExlc3Nvbk1pbnV0ZSA9IG5ldyBEYXRlKGxlc3Nvbi5lbmREYXRlKS5nZXRNaW51dGVzKCk7XHJcblxyXG4gICAgICAgIGNvbnN0IHBlcmlvZCA9IHRoaXMuYWxsUGVyaW9kcy5maW5kKHAgPT4gXHJcbiAgICAgICAgICAgIG5ldyBEYXRlKHAuc3RhcnREYXRlKS5nZXREYXkoKSA9PSBzdGFydExlc3NvbkRheSAmJiBcclxuICAgICAgICAgICAgbmV3IERhdGUocC5zdGFydERhdGUpLmdldEhvdXJzKCkgPT0gc3RhcnRMZXNzb25Ib3VyICYmIFxyXG4gICAgICAgICAgICBuZXcgRGF0ZShwLnN0YXJ0RGF0ZSkuZ2V0TWludXRlcygpID09IHN0YXJ0TGVzc29uTWludXRlICYmIFxyXG4gICAgICAgICAgICBuZXcgRGF0ZShwLmVuZERhdGUpLmdldERheSgpID09IGVuZExlc3NvbkRheSAmJiBcclxuICAgICAgICAgICAgbmV3IERhdGUocC5lbmREYXRlKS5nZXRIb3VycygpID09IGVuZExlc3NvbkhvdXIgJiYgXHJcbiAgICAgICAgICAgIG5ldyBEYXRlKHAuZW5kRGF0ZSkuZ2V0TWludXRlcygpID09IGVuZExlc3Nvbk1pbnV0ZVxyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIGlmIChwZXJpb2Qpe1xyXG4gICAgICAgICAgICBuYW1lID0gcGVyaW9kLm5hbWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHJldHVybiBuYW1lO1xyXG4gICAgfSAgXHJcblxyXG4gICAgZ2V0U3ViamVjdENvbG91cihsZXNzb246IExlc3Nvbik6IHN0cmluZyB7XHJcbiAgICAgICAgbGV0IHN1YmplY3QgPSBTdWJqZWN0O1xyXG4gICAgICAgIGxldCBjb2xvciA9IFwiXCI7XHJcblxyXG4gICAgICAgIHN3aXRjaCAobGVzc29uLnN1YmplY3QpIHtcclxuICAgICAgICAgICAgY2FzZSBzdWJqZWN0LmFydDoge1xyXG4gICAgICAgICAgICAgICAgY29sb3IgPSBcIiM4QjAwMDBcIjtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhc2Ugc3ViamVjdC5jb21wdXRpbmc6IHtcclxuICAgICAgICAgICAgICAgIGNvbG9yID0gXCIjOEI0NTEzXCI7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXNlIHN1YmplY3QuZGVzaWduOiB7XHJcbiAgICAgICAgICAgICAgICBjb2xvciA9IFwiIzgwODAwMFwiO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2FzZSBzdWJqZWN0LmVuZ2xpc2g6IHtcclxuICAgICAgICAgICAgICAgIGNvbG9yID0gXCIjMkVDQ0ZBXCI7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXNlIHN1YmplY3QuZ2VvZ3JhcGh5OiB7XHJcbiAgICAgICAgICAgICAgICBjb2xvciA9IFwiI0ZBNThGNFwiO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2FzZSBzdWJqZWN0Lmhpc3Rvcnk6IHtcclxuICAgICAgICAgICAgICAgIGNvbG9yID0gXCIjMDRCNDA0XCI7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXNlIHN1YmplY3QubGFuZ3VhZ2VzOiB7XHJcbiAgICAgICAgICAgICAgICBjb2xvciA9IFwiI0JGMDBGRlwiO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2FzZSBzdWJqZWN0Lm1hdGg6IHtcclxuICAgICAgICAgICAgICAgIGNvbG9yID0gXCIjRkY4MDAwXCI7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXNlIHN1YmplY3QubXVzaWM6IHtcclxuICAgICAgICAgICAgICAgIGNvbG9yID0gXCIjNjQyRUZFXCI7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXNlIHN1YmplY3QucGU6IHtcclxuICAgICAgICAgICAgICAgIGNvbG9yID0gXCIjRkZGRjAwXCI7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXNlIHN1YmplY3QucmVnOiB7XHJcbiAgICAgICAgICAgICAgICBjb2xvciA9IFwiIzA4NkE4N1wiO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2FzZSBzdWJqZWN0LnNjaWVuY2U6IHtcclxuICAgICAgICAgICAgICAgIGNvbG9yID0gXCIjRkYwMDAwXCI7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGNvbG9yO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFRhYkRhdGVMZXNzb24oKSB7XHJcbiAgICAgICAgZm9yIChsZXQgdGFiRGF0ZSBvZiB0aGlzLmRhdGVSYW5nZSkge1xyXG4gICAgICAgICAgICB0aGlzLmdldExlc3NvbnNGb3JEYXRlKG5ldyBEYXRlKHRhYkRhdGUpKTtcclxuICAgICAgICAgICAgbGV0IHRpbWV0YWJsZVRhYiA9IG5ldyBUaW1ldGFibGVUYWI7XHJcblxyXG4gICAgICAgICAgICB0aW1ldGFibGVUYWIuZGF0ZSA9IHRhYkRhdGU7XHJcbiAgICAgICAgICAgIHRpbWV0YWJsZVRhYi5sZXNzb25zID0gdGhpcy5sZXNzb25zRm9yRGF0ZTtcclxuICAgICAgICAgICAgdGhpcy50YWJEYXRlcy5wdXNoKHRpbWV0YWJsZVRhYik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIG9uVGFiU3dpcGUoYXJnczogU2VsZWN0ZWRJbmRleENoYW5nZWRFdmVudERhdGEpIHsgICAgICAgIFxyXG4gICAgICAgIGlmIChhcmdzLm9sZEluZGV4ICE9PSAtMSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmb3IgKGxldCB0YWJEYXRlIG9mIHRoaXMudGFiRGF0ZXMpIHtcclxuICAgICAgICAgICAgaWYgKG5ldyBEYXRlKHRhYkRhdGUuZGF0ZSkuZ2V0RGF0ZSgpID09PSB0aGlzLmxlc3NvbkRhdGUuZ2V0RGF0ZSgpKSB7XHJcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHt0aGlzLnRhYlNlbGVjdGVkSW5kZXggPSB0aGlzLmRhdGVSYW5nZS5maW5kSW5kZXgoeCA9PiB4ID09IHRhYkRhdGUuZGF0ZSk7fSwgMjAwKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gICBcclxuICAgIH1cclxuXHJcbiAgICBvblRhcEhvbWV3b3JrKGxlc3NvbjogTGVzc29uKSB7XHJcbiAgICAgICAgY29uc3QgaG9tZXdvcmsgPSB0aGlzLmFsbER1ZUhvbWV3b3Jrcy5maW5kKGggPT5cclxuICAgICAgICAgICAgaC5zdWJqZWN0ID09IGxlc3Nvbi5zdWJqZWN0XHJcbiAgICAgICAgKTtcclxuICAgICAgICBcclxuICAgICAgICB0aGlzLnJvdXRlci5uYXZpZ2F0ZShbYC9ob21ld29ya2RldGFpbHMvJHtob21ld29yay5pZH1gXSk7XHJcbiAgICB9XHJcbn0iXX0=